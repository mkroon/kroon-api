var path = require('path');

exports.prepareUpdate = function(folder, repoUrl) {
  set('+e');
  var branchExist = exec('git ls-remote --exit-code origin gh-pages').code !== 2;
  set('-e');

  if (!branchExist)
    return;

  // download current gh-pages content
  mkdir('-p', '.ghpages-tmp');
  cd('.ghpages-tmp');
  exec('git clone --depth=1 --branch=gh-pages ' + repoUrl + ' .');
  var relativeFolder = path.join('..', folder, '/');
  cp('-Rn', '.', relativeFolder); // copy, not overwrite
  rm('-rf', path.join(relativeFolder, '.git'));
  cd('..');
}
